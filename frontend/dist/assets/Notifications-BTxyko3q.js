import{r as a,j as e,ae as m,aN as T,ag as v,ah as N,aj as $,aO as E,aP as P,aQ as R,aR as B}from"./index-By3V3s7V.js";import{E as _}from"./external-link-BdNGUAry.js";import{C as U}from"./check-CjuQ9Icq.js";function Q(){const{t}=$(),[s,h]=a.useState(null),[w,k]=a.useState(!0),[d,y]=a.useState(null),[u,f]=a.useState(!1),[x,b]=a.useState(!1),[g,l]=a.useState(null),[j,c]=a.useState(null),L=async()=>{try{const{data:n}=await E();h(n)}catch{l("Не удалось загрузить настройки")}finally{k(!1)}};a.useEffect(()=>{L()},[]);const C=async()=>{f(!0),l(null),c(null);try{const{data:n}=await P();y(n.bot_link),c("Ссылка создана. Откройте её в Telegram в течение 5 минут.")}catch{l("Не удалось создать ссылку")}finally{f(!1)}},S=async()=>{var n,o;b(!0),l(null),c(null);try{await R(),c(t("notifications.test_sent"))}catch(i){const p=(o=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:o.detail;l(typeof p=="string"?p:"Не удалось отправить тест")}finally{b(!1)}},r=async(n,o)=>{if(s!=null&&s.telegram_linked){l(null);try{const{data:i}=await B({[n]:o});h(i)}catch{l("Не удалось сохранить")}}};return w?e.jsx("div",{className:"flex items-center justify-center min-h-[200px] text-vg-muted",children:t("common.loading")}):e.jsxs("div",{className:"space-y-8 max-w-4xl",children:[e.jsx(m,{children:e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(T,{className:"w-7 h-7 text-vg-accent"}),t("notifications.title")]})}),g&&e.jsx("div",{className:"p-4 rounded-lg bg-red-500/20 border border-red-500/40 text-red-300",children:g}),j&&e.jsx("div",{className:"p-4 rounded-lg bg-green-500/20 border border-green-500/40 text-green-300",children:j}),e.jsx(m,{children:e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-vg-accent/20 flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-vg-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s!=null&&s.telegram_linked?t("notifications.telegram_connected"):t("notifications.telegram_connect")}),e.jsx("p",{className:"text-sm text-vg-muted",children:t("notifications.telegram_connect_hint")})]})]}),s!=null&&s.telegram_linked?e.jsxs("div",{className:"flex gap-3",children:[e.jsx(N,{variant:"secondary",size:"sm",onClick:S,disabled:x,children:t(x?"common.loading":"notifications.test_notification")}),e.jsxs("a",{href:s.bot_link||"https://t.me/cohortsec_bot",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-vg-surface border border-white/10 hover:border-vg-accent/50 text-sm",children:[e.jsx(_,{className:"w-4 h-4"}),t("notifications.open_bot")]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{onClick:C,disabled:u,children:t(u?"common.loading":"notifications.connect_btn")}),d&&e.jsxs("div",{className:"p-4 bg-vg-surface rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-sm text-vg-muted mb-2",children:"Откройте эту ссылку в Telegram:"}),e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"text-vg-accent hover:underline break-all",children:d})]})]})]})}),(s==null?void 0:s.telegram_linked)&&e.jsx(m,{children:e.jsxs(v,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-vg-accent"}),"Настройки уведомлений"]}),e.jsx("p",{className:"text-sm text-vg-muted mb-4",children:t("notifications.important_note")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("notifications.subscribe")}),e.jsx("button",{onClick:()=>r("is_subscribed",!s.is_subscribed),className:`relative w-12 h-6 rounded-full transition-colors ${s.is_subscribed?"bg-vg-accent":"bg-vg-surface"}`,children:e.jsx("span",{className:`absolute top-1 w-4 h-4 rounded-full bg-white transition-all ${s.is_subscribed?"left-7":"left-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("notifications.push")}),e.jsx("button",{onClick:()=>r("push_enabled",!s.push_enabled),className:`relative w-12 h-6 rounded-full transition-colors ${s.push_enabled?"bg-vg-accent":"bg-vg-surface"}`,children:e.jsx("span",{className:`absolute top-1 w-4 h-4 rounded-full bg-white transition-all ${s.push_enabled?"left-7":"left-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("notifications.news")}),e.jsx("button",{onClick:()=>r("news_enabled",!s.news_enabled),className:`relative w-12 h-6 rounded-full transition-colors ${s.news_enabled?"bg-vg-accent":"bg-vg-surface"}`,children:e.jsx("span",{className:`absolute top-1 w-4 h-4 rounded-full bg-white transition-all ${s.news_enabled?"left-7":"left-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("notifications.lifehacks")}),e.jsx("button",{onClick:()=>r("lifehacks_enabled",!s.lifehacks_enabled),className:`relative w-12 h-6 rounded-full transition-colors ${s.lifehacks_enabled?"bg-vg-accent":"bg-vg-surface"}`,children:e.jsx("span",{className:`absolute top-1 w-4 h-4 rounded-full bg-white transition-all ${s.lifehacks_enabled?"left-7":"left-1"}`})})]})]})]})})]})}export{Q as default};
