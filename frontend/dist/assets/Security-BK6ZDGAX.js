import{Y as ce,r as t,j as e,ae as x,N as le,ag as o,aq as y,a0 as w,K,ah as i,ar as ne,ac as l,$ as ie,as as re,aj as de}from"./index-By3V3s7V.js";import{L as R}from"./link-2-CB_FqDY2.js";import{T as C}from"./trash-2-D-KNdMYF.js";import{C as oe}from"./check-CjuQ9Icq.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=ce("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);function we(){const{t:d}=de(),[n,$]=t.useState("biometric"),[xe,he]=t.useState(!1),[S,_]=t.useState(!1),[f,q]=t.useState([]),[k,G]=t.useState({confidence_threshold:.65,failed_attempts:0,locked_until:null}),[N,A]=t.useState(!1),[F,L]=t.useState(""),[ue,pe]=t.useState(null),[ge,je]=t.useState(null),[T,O]=t.useState([]),[p,Q]=t.useState("email"),[g,V]=t.useState(""),[B,E]=t.useState({}),[W,M]=t.useState(null),[P,Y]=t.useState([]),[z,H]=t.useState("vk"),[D,I]=t.useState([]),[m,J]=t.useState(null),b=()=>{l.listFaces().then(s=>q(s.data)).catch(()=>{}),l.getBiometricSettings().then(s=>G(s.data)).catch(()=>{})},u=()=>{l.listContacts().then(s=>O(s.data)).catch(()=>{})},j=()=>{l.listConnectedAccounts().then(s=>Y(s.data)).catch(()=>{})},U=()=>{l.getSecurityLogs().then(s=>I(s.data)).catch(()=>{})},h=()=>{l.getSecurityStatus().then(s=>J(s.data)).catch(()=>{})};t.useEffect(()=>{h()},[]),t.useEffect(()=>{n==="biometric"?b():n==="contacts"?u():n==="accounts"?j():n==="log"&&U()},[n]);const X=async s=>{var a,c;A(!0);try{try{const r=await l.checkBiometricQuality(s);if(!r.data.ok){alert(r.data.message);return}}catch{}await l.registerFace(s,F||void 0),L(""),b(),h()}catch(r){alert(((c=(a=r.response)==null?void 0:a.data)==null?void 0:c.detail)||"Ошибка")}finally{A(!1)}},Z=async s=>{if(confirm("Удалить это лицо?"))try{await l.deleteFace(s),b(),h()}catch{alert("Ошибка удаления")}},ee=async()=>{var s,a;if(g.trim())try{const c=await l.addContact(p,g.trim());M(c.data.id),V(""),u(),h(),c.data.dev_code&&alert(`Код для подтверждения (dev): ${c.data.dev_code}`)}catch(c){alert(((a=(s=c.response)==null?void 0:s.data)==null?void 0:a.detail)||"Ошибка")}},se=async s=>{var c,r;const a=B[s];if(!(!a||a.length<4))try{await l.verifyContact(s,a),E(v=>({...v,[s]:""})),M(null),u(),h()}catch(v){alert(((r=(c=v.response)==null?void 0:c.data)==null?void 0:r.detail)||"Ошибка")}},te=async()=>{var s,a;try{await l.addConnectedAccount(z,void 0,{}),j(),h()}catch(c){alert(((a=(s=c.response)==null?void 0:s.data)==null?void 0:a.detail)||"Ошибка")}},ae=[{id:"biometric",label:"Биометрия",icon:y},{id:"contacts",label:"Резервные контакты",icon:w},{id:"accounts",label:"Подключённые аккаунты",icon:R},{id:"log",label:"Журнал безопасности",icon:K}];return e.jsxs("div",{className:"space-y-8 max-w-4xl",children:[e.jsx(x,{children:e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(le,{className:"w-7 h-7 text-vg-accent"}),d("security.title")]})}),m&&e.jsx(x,{children:e.jsxs(o,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Уровень защиты"}),e.jsxs("span",{className:"text-2xl font-bold text-[#00FFAA]",children:[m.security_level,"%"]})]}),e.jsx("div",{className:"h-2 bg-vg-surface rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#00FFAA] to-[#3B82F6] rounded-full transition-all",style:{width:`${m.security_level}%`}})}),e.jsxs("p",{className:"text-sm text-vg-muted mt-2",children:["MFA: ",m.mfa_enabled?"вкл":"выкл"," · Лиц: ",m.biometric_faces," · Контактов: ",m.verified_contacts," · Аккаунтов: ",m.connected_accounts]})]})}),e.jsxs(x,{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Разделы"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ae.map(s=>e.jsxs("button",{onClick:()=>$(s.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${n===s.id?"bg-vg-accent text-white":"bg-vg-surface hover:bg-vg-surface/80"}`,children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},s.id))})]}),e.jsxs(x,{children:[n==="biometric"&&e.jsxs(o,{className:"p-6 space-y-6",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-vg-success"}),"Биометрическая аутентификация"]}),e.jsx("p",{className:"text-sm text-vg-muted",children:"Добавьте до 5 лиц для входа по лицу. Поддерживаются разные ракурсы и фото с очками."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Добавить лицо"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx("input",{type:"text",placeholder:"Подпись (опционально)",value:F,onChange:s=>L(s.target.value),className:"px-4 py-2 bg-vg-surface border border-white/10 rounded-lg text-white w-48"}),e.jsx("input",{type:"file",accept:"image/*",capture:"user",onChange:s=>{var c;const a=(c=s.target.files)==null?void 0:c[0];a&&X(a),s.target.value=""},disabled:N,className:"hidden",id:"face-upload"}),e.jsx("label",{htmlFor:"face-upload",children:e.jsx(i,{as:"span",disabled:N,children:N?"Загрузка…":"Загрузить фото"})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3",children:["Сохранённые лица (",f.length,"/5)"]}),f.length===0?e.jsx("p",{className:"text-vg-muted text-sm",children:"Нет добавленных лиц"}):e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-vg-surface/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-vg-success/20 flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-vg-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.label||`Лицо #${s.id}`}),e.jsx("p",{className:"text-xs text-vg-muted",children:new Date(s.created_at).toLocaleDateString()})]})]}),e.jsx("button",{onClick:()=>Z(s.id),className:"p-2 text-vg-danger hover:bg-vg-danger/20 rounded-lg transition-colors","aria-label":"Удалить",children:e.jsx(C,{className:"w-4 h-4"})})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Порог уверенности"}),e.jsxs("p",{className:"text-sm text-vg-muted mb-2",children:["Текущий: ",k.confidence_threshold," (по умолчанию 0.65)"]}),k.locked_until&&e.jsx("p",{className:"text-vg-warning text-sm",children:"Биометрия временно заблокирована после неудачных попыток"})]})]}),n==="contacts"&&e.jsxs(o,{className:"p-6 space-y-6",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-vg-accent"}),"Резервные контакты"]}),e.jsx("p",{className:"text-sm text-vg-muted",children:"Добавьте email и телефоны для восстановления пароля и уведомлений. Минимум 2 контакта рекомендуется."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Добавить контакт"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("select",{value:p,onChange:s=>Q(s.target.value),className:"px-4 py-2 bg-vg-surface border border-white/10 rounded-lg text-white",children:[e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"phone",children:"Телефон"})]}),e.jsx("input",{type:p==="email"?"email":"tel",placeholder:p==="email"?"email@example.com":"+7 999 123-45-67",value:g,onChange:s=>V(s.target.value),className:"px-4 py-2 bg-vg-surface border border-white/10 rounded-lg text-white flex-1 min-w-[200px]"}),e.jsx(i,{onClick:ee,disabled:!g.trim(),children:"Добавить"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Список контактов"}),T.length===0?e.jsx("p",{className:"text-vg-muted text-sm",children:"Нет добавленных контактов"}):e.jsx("div",{className:"space-y-2",children:T.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-vg-surface/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.contact_type==="email"?e.jsx(w,{className:"w-5 h-5 text-vg-muted"}):e.jsx(ne,{className:"w-5 h-5 text-vg-muted"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.value}),e.jsxs("div",{className:"flex gap-2",children:[s.verified?e.jsxs("span",{className:"text-xs text-vg-success flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Подтверждён"]}):e.jsx("span",{className:"text-xs text-vg-warning",children:"Не подтверждён"}),s.is_primary&&e.jsx("span",{className:"text-xs text-vg-accent",children:"Основной"})]}),!s.verified&&W===s.id&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("input",{type:"text",placeholder:"Код",value:B[s.id]||"",onChange:a=>E(c=>({...c,[s.id]:a.target.value})),className:"px-2 py-1 bg-vg-surface border border-white/10 rounded text-white w-24"}),e.jsx(i,{size:"sm",onClick:()=>se(s.id),children:"Подтвердить"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!s.is_primary&&s.verified&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{l.setPrimaryContact(s.id).then(u)},children:"Основной"}),e.jsx("button",{onClick:()=>{confirm("Удалить контакт?")&&l.deleteContact(s.id).then(u)},className:"p-2 text-vg-danger hover:bg-vg-danger/20 rounded-lg",children:e.jsx(C,{className:"w-4 h-4"})})]})]},s.id))})]})]}),n==="accounts"&&e.jsxs(o,{className:"p-6 space-y-6",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-vg-accent"}),"Подключённые аккаунты"]}),e.jsx("p",{className:"text-sm text-vg-muted",children:"Подключите аккаунты для мониторинга подозрительных действий (VK, почта, банки)."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Подключить аккаунт"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("select",{value:z,onChange:s=>H(s.target.value),className:"px-4 py-2 bg-vg-surface border border-white/10 rounded-lg text-white",children:[e.jsx("option",{value:"vk",children:"VK"}),e.jsx("option",{value:"email_gmail",children:"Gmail"}),e.jsx("option",{value:"email_yandex",children:"Яндекс"}),e.jsx("option",{value:"email_mailru",children:"Mail.ru"}),e.jsx("option",{value:"bank_sber",children:"Сбербанк"}),e.jsx("option",{value:"bank_tinkoff",children:"Тинькофф"}),e.jsx("option",{value:"telegram",children:"Telegram"})]}),e.jsx(i,{onClick:te,children:"Подключить"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Список аккаунтов"}),P.length===0?e.jsx("p",{className:"text-vg-muted text-sm",children:"Нет подключённых аккаунтов"}):e.jsx("div",{className:"space-y-2",children:P.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-vg-surface/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.display_name}),e.jsxs("p",{className:"text-xs text-vg-muted",children:[s.status==="active"?e.jsx("span",{className:"text-vg-success",children:"Активен"}):e.jsx("span",{className:"text-vg-warning",children:s.status}),s.last_check_at&&" · "+new Date(s.last_check_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>l.refreshConnectedAccount(s.id).then(j),children:"Проверить"}),e.jsx("button",{onClick:()=>{confirm("Отключить аккаунт?")&&l.deleteConnectedAccount(s.id).then(j)},className:"p-2 text-vg-danger hover:bg-vg-danger/20 rounded-lg",children:e.jsx(C,{className:"w-4 h-4"})})]})]},s.id))})]})]}),n==="log"&&e.jsxs(o,{className:"p-6 space-y-6",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-vg-accent"}),"Журнал безопасности"]}),e.jsx("p",{className:"text-sm text-vg-muted",children:"Все события, связанные с безопасностью: входы, попытки, изменения настроек."}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-vg-muted border-b border-white/10",children:[e.jsx("th",{className:"py-2",children:"Дата"}),e.jsx("th",{className:"py-2",children:"Событие"}),e.jsx("th",{className:"py-2",children:"IP"}),e.jsx("th",{className:"py-2",children:"Статус"})]})}),e.jsx("tbody",{children:D.map(s=>e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("td",{className:"py-2",children:new Date(s.created_at).toLocaleString()}),e.jsx("td",{className:"py-2",children:s.event_type}),e.jsx("td",{className:"py-2",children:s.ip_address||"—"}),e.jsx("td",{className:"py-2",children:s.success?e.jsx("span",{className:"text-vg-success",children:"OK"}):e.jsx("span",{className:"text-vg-danger",children:"Ошибка"})})]},s.id))})]}),D.length===0&&e.jsx("p",{className:"text-vg-muted text-sm py-4",children:"Нет записей"})]})]})]}),e.jsx(x,{children:e.jsxs(o,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-vg-accent/20 flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-vg-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d("security.mfa")}),e.jsx("p",{className:"text-sm text-vg-muted",children:d("security.mfa_desc")})]})]}),e.jsx(i,{variant:"secondary",size:"sm",children:d("security.setup_mfa")})]})}),e.jsx(x,{children:e.jsxs(o,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-vg-accent"}),d("security.change_password")]}),e.jsx(i,{variant:"secondary",size:"sm",onClick:()=>_(!S),children:"Изменить"})]}),S&&e.jsxs("form",{className:"space-y-4 pt-4 border-t border-white/10",children:[e.jsx("input",{type:"password",placeholder:"Текущий пароль",className:"w-full px-4 py-3 bg-vg-surface border border-white/10 rounded-lg text-white"}),e.jsx("input",{type:"password",placeholder:"Новый пароль",className:"w-full px-4 py-3 bg-vg-surface border border-white/10 rounded-lg text-white"}),e.jsx("input",{type:"password",placeholder:"Повторите пароль",className:"w-full px-4 py-3 bg-vg-surface border border-white/10 rounded-lg text-white"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{children:d("common.save")}),e.jsx(i,{variant:"ghost",type:"button",onClick:()=>_(!1),children:d("common.cancel")})]})]})]})}),e.jsx(x,{children:e.jsxs(o,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-vg-accent"}),d("security.sessions")]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex justify-between items-center p-4 bg-vg-surface/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Текущая сессия"}),e.jsx("p",{className:"text-sm text-vg-muted",children:"Chrome, Windows"})]}),e.jsx("span",{className:"text-xs text-vg-success",children:"Активна"})]})})]})})]})}export{we as default};
