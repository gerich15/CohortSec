import{Y as p,r as a,j as e,ae as l,H as D,ag as d,ah as i,R as P,N as T,aj as V,am as W,an as Y,a7 as Z,a8 as $,a5 as o,ao as G,ap as J}from"./index-By3V3s7V.js";import{F as Q}from"./file-check-DaVjP7wn.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=p("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=p("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=p("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=p("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);function x({children:t,hint:n}){return e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:t}),n&&e.jsx("span",{className:"block text-xs text-vg-muted mt-0.5",children:n})]})}function te(){const{t}=V(),[n,g]=a.useState("simple"),[j,b]=a.useState([]),[f,v]=a.useState([]),[h,N]=a.useState(null),[k,A]=a.useState(!0),[y,K]=a.useState(!0),[w,q]=a.useState(!1),[S,_]=a.useState(!1),[C,m]=a.useState(!1),[c,r]=a.useState({name:"",endpoint:"",access_key:"",secret_key:"",bucket:"",prefix:""}),[E,B]=a.useState(!1),[H,I]=a.useState(!0),u=()=>{W().then(s=>b(s.data)).catch(()=>b([])),Y().then(s=>v(s.data)).catch(()=>v([])),Z().then(s=>N({last_backup_human:s.data.last_backup_human,cloud_connected:s.data.cloud_connected})).catch(()=>N(null)).finally(()=>I(!1))};a.useEffect(()=>{u()},[]);const L=async()=>{_(!0);try{await $({backup_photos:k,backup_contacts:y,backup_documents:w}),o.success("Резервная копия запущена"),u()}catch{o.error("Подключи облако")}finally{_(!1)}},M=async s=>{s.preventDefault(),B(!0);try{await G({...c,prefix:c.prefix||void 0}),m(!1),r({name:"",endpoint:"",access_key:"",secret_key:"",bucket:"",prefix:""}),u(),o.success("Облако подключено")}catch{o.error("Ошибка")}finally{B(!1)}},O=s=>{J(s).then(()=>{u(),o.success("Бэкап запущен")}).catch(()=>o.error("Ошибка"))},R=s=>s<1024?s+" Б":s<1024*1024?(s/1024).toFixed(1)+" КБ":(s/(1024*1024)).toFixed(1)+" МБ";return H?e.jsx("div",{className:"flex justify-center min-h-[200px] items-center",children:e.jsx("p",{className:"text-vg-muted",children:t("common.loading")})}):e.jsxs("div",{className:"space-y-8 max-w-4xl",children:[e.jsxs(l,{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(D,{className:"w-7 h-7 text-vg-accent"}),"Резервное копирование"]}),e.jsx("p",{className:"text-vg-muted mt-1 text-sm",children:"Простой бэкап — одна кнопка. Облачные хранилища — подключите своё S3-совместимое облако."})]}),e.jsx(l,{children:e.jsxs("div",{className:"flex gap-2 border-b border-white/10",children:[e.jsx("button",{onClick:()=>g("simple"),className:"px-4 py-2 rounded-t-lg font-medium "+(n==="simple"?"bg-vg-accent/20 text-vg-accent border-b-2 border-vg-accent":"text-vg-muted hover:text-vg-text"),children:t("backup.simple")}),e.jsx("button",{onClick:()=>g("cloud"),className:"px-4 py-2 rounded-t-lg font-medium "+(n==="cloud"?"bg-vg-accent/20 text-vg-accent border-b-2 border-vg-accent":"text-vg-muted hover:text-vg-text"),children:t("backup.advanced")})]})}),n==="simple"&&e.jsx(l,{children:e.jsxs(d,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-vg-accent"}),t("backup.simple")]}),e.jsx("p",{className:"text-sm text-vg-muted mb-4",children:"Отметьте, что копировать. Для работы нужен хотя бы один подключённый облачный контейнер во вкладке «Облачные хранилища»."}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:s=>A(s.target.checked),className:"rounded border-white/20"}),e.jsx("span",{children:t("backup.photos")})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:s=>K(s.target.checked),className:"rounded border-white/20"}),e.jsx("span",{children:t("backup.contacts")})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>q(s.target.checked),className:"rounded border-white/20"}),e.jsx("span",{children:t("backup.documents")})]})]}),e.jsx(i,{onClick:L,disabled:S,className:"w-full mb-4",size:"lg",children:t(S?"common.loading":"backup.run_now")}),e.jsxs("p",{className:"text-sm text-vg-muted",children:[t("backup.last_backup"),": ",e.jsx("strong",{children:(h==null?void 0:h.last_backup_human)||t("backup.never")})]}),h&&!h.cloud_connected&&e.jsx("p",{className:"text-sm text-vg-warning mt-2",children:t("backup.cloud_hint")})]})}),n==="cloud"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-vg-accent"}),t("backup.advanced")]}),e.jsx("p",{className:"text-sm text-vg-muted mt-1",children:"Подключите S3-совместимое хранилище (Яндекс Облако, MinIO, Amazon S3 и т.п.) — один раз, дальше бэкап запускается одной кнопкой."})]}),e.jsx(i,{leftIcon:e.jsx(F,{className:"w-4 h-4"}),onClick:()=>m(!C),children:t("backup.connect_cloud")})]})}),C&&e.jsx(l,{children:e.jsxs(d,{className:"p-6",children:[e.jsx("h4",{className:"font-semibold text-white mb-4",children:"Новое подключение"}),e.jsxs("form",{onSubmit:M,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{hint:"Как вы хотите назвать это хранилище (например: Яндекс Облако)",children:"Название"}),e.jsx("input",{placeholder:"Например: Мой бэкап",value:c.name,onChange:s=>r({...c,name:s.target.value}),required:!0,className:"w-full px-4 py-3 bg-vg-surface border border-white/10 rounded-lg text-white placeholder:text-vg-muted focus:border-vg-accent focus:outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{hint:"Адрес сервера S3: host или host:port (например storage.yandexcloud.net или s3.amazonaws.com)",children:"Endpoint"}),e.jsx("input",{placeholder:"storage.yandexcloud.net",value:c.endpoint,onChange:s=>r({...c,endpoint:s.target.value}),required:!0,className:"w-full px-4 py-3 bg-vg-surface border border-white/10 rounded-lg text-white placeholder:text-vg-muted focus:border-vg-accent focus:outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{hint:"Имя контейнера (bucket), куда будут сохраняться файлы",children:"Bucket"}),e.jsx("input",{placeholder:"my-backup-bucket",value:c.bucket,onChange:s=>r({...c,bucket:s.target.value}),required:!0,className:"w-full px-4 py-3 bg-vg-surface border border-white/10 rounded-lg text-white placeholder:text-vg-muted focus:border-vg-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{hint:"Идентификатор доступа (из настроек облака)",children:"Access Key"}),e.jsx("input",{placeholder:"Access Key",value:c.access_key,onChange:s=>r({...c,access_key:s.target.value}),required:!0,className:"w-full px-4 py-3 bg-vg-surface border border-white/10 rounded-lg text-white placeholder:text-vg-muted focus:border-vg-accent focus:outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{hint:"Секретный ключ (хранится только у вас)",children:"Secret Key"}),e.jsx("input",{type:"password",placeholder:"Secret Key",value:c.secret_key,onChange:s=>r({...c,secret_key:s.target.value}),required:!0,className:"w-full px-4 py-3 bg-vg-surface border border-white/10 rounded-lg text-white placeholder:text-vg-muted focus:border-vg-accent focus:outline-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{hint:"Необязательно. Папка внутри bucket (например backup/2024)",children:"Префикс (папка)"}),e.jsx("input",{placeholder:"Оставьте пустым или укажите папку",value:c.prefix,onChange:s=>r({...c,prefix:s.target.value}),className:"w-full px-4 py-3 bg-vg-surface border border-white/10 rounded-lg text-white placeholder:text-vg-muted focus:border-vg-accent focus:outline-none"})]}),e.jsxs("div",{className:"flex gap-3 pt-1",children:[e.jsx(i,{type:"submit",loading:E,children:"Подключить"}),e.jsx(i,{variant:"ghost",type:"button",onClick:()=>m(!1),children:t("common.cancel")})]})]})]})}),e.jsx(l,{children:e.jsx(d,{className:"p-6",children:j.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"w-12 h-12 text-vg-muted mx-auto mb-3 opacity-60"}),e.jsx("p",{className:"text-vg-muted mb-1",children:"Нет подключенных облаков"}),e.jsx("p",{className:"text-sm text-vg-muted mb-4",children:"Нажмите «Подключить облако» выше и заполните данные хранилища. Подробная инструкция — в блоке ниже."}),e.jsx(i,{leftIcon:e.jsx(F,{className:"w-4 h-4"}),onClick:()=>m(!0),children:t("backup.connect_cloud")})]}):e.jsx("div",{className:"space-y-3",children:j.map(s=>e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-3 p-4 bg-vg-surface/50 rounded-xl border border-white/5",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-vg-muted mt-0.5",children:[s.endpoint," → ",s.bucket,s.prefix?` / ${s.prefix}`:""]})]}),e.jsx(i,{size:"sm",onClick:()=>O(s.id),children:"Запустить бэкап"})]},s.id))})})}),f.length>0&&e.jsx(l,{children:e.jsxs(d,{className:"p-6",children:[e.jsx("h4",{className:"font-semibold mb-4 text-white",children:"Журнал копирований"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-left py-2 text-vg-muted font-medium",children:"Конфиг"}),e.jsx("th",{className:"text-left py-2 text-vg-muted font-medium",children:"Статус"}),e.jsx("th",{className:"text-left py-2 text-vg-muted font-medium",children:"Размер"})]})}),e.jsx("tbody",{children:f.slice(0,10).map(s=>e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("td",{className:"py-2",children:s.config_id}),e.jsx("td",{className:"py-2 "+(s.status==="success"?"text-vg-success":s.status==="failed"?"text-vg-danger":"text-vg-warning"),children:s.status==="success"?"Успешно":s.status==="failed"?"Ошибка":s.status}),e.jsx("td",{className:"py-2 text-vg-muted",children:R(s.total_size_bytes)})]},s.id))})]})})]})})]}),e.jsx(l,{children:e.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2 mt-10 pt-6 border-t border-white/10",children:[e.jsx(P,{className:"w-5 h-5 text-vg-accent"}),"Справка и инструкции"]})}),e.jsx(l,{children:e.jsx(d,{className:"p-6 md:p-8 overflow-hidden",hover:!1,children:e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("span",{className:"flex items-center justify-center w-10 h-10 rounded-xl bg-vg-accent/20 text-vg-accent shrink-0",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:"Что такое бэкап и зачем он нужен"}),e.jsx("p",{className:"text-sm text-vg-muted mt-1",children:"Резервная копия — это сохранённая копия ваших данных (фото, контакты, документы) в облаке. Если устройство потеряется, сломается или будет взломан, данные можно восстановить из бэкапа. На сервисе CohortSec копирование идёт в ваше облако; данные шифруются перед отправкой."})]})]})})}),e.jsx(l,{children:e.jsxs(d,{className:"p-6 md:p-8 overflow-hidden",hover:!1,children:[e.jsxs("h3",{className:"text-base font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-vg-accent"}),"Как сделать бэкап по шагам"]}),e.jsxs("ol",{className:"space-y-3",children:[e.jsxs("li",{className:"flex gap-3 items-start",children:[e.jsx("span",{className:"flex items-center justify-center w-7 h-7 rounded-lg bg-vg-accent/20 text-vg-accent font-semibold text-sm shrink-0",children:"1"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-white",children:"Подключите облако"})," — вкладка «Облачные хранилища», кнопка «Подключить облако», введите endpoint, ключи и bucket (см. инструкцию ниже)."]})]}),e.jsxs("li",{className:"flex gap-3 items-start",children:[e.jsx("span",{className:"flex items-center justify-center w-7 h-7 rounded-lg bg-vg-accent/20 text-vg-accent font-semibold text-sm shrink-0",children:"2"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-white",children:"Выберите, что копировать"})," — на вкладке «Простой бэкап» отметьте фото, контакты, документы."]})]}),e.jsxs("li",{className:"flex gap-3 items-start",children:[e.jsx("span",{className:"flex items-center justify-center w-7 h-7 rounded-lg bg-vg-accent/20 text-vg-accent font-semibold text-sm shrink-0",children:"3"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-white",children:"Нажмите «Создать резервную копию»"})," — дождитесь окончания (статус в журнале на вкладке облаков)."]})]}),e.jsxs("li",{className:"flex gap-3 items-start",children:[e.jsx("span",{className:"flex items-center justify-center w-7 h-7 rounded-lg bg-vg-accent/20 text-vg-accent font-semibold text-sm shrink-0",children:"4"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-white",children:"Проверьте результат"})," — дата последней копии и количество объектов отображаются на странице. Рекомендуем делать бэкап регулярно."]})]})]})]})}),e.jsx(l,{children:e.jsxs(d,{className:"p-6 md:p-8 overflow-hidden",hover:!1,children:[e.jsxs("h3",{className:"text-base font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-vg-accent"}),"Как подключить облако: кратко"]}),e.jsx("p",{className:"text-sm text-vg-muted mb-4",children:"Нужно S3-совместимое хранилище. Укажите endpoint (адрес сервера), bucket (имя контейнера) и ключи доступа (Access Key и Secret Key). Где взять данные:"}),e.jsxs("ul",{className:"space-y-3 text-sm text-vg-muted",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-vg-accent shrink-0",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Яндекс Облако"})," — в консоли: Object Storage → бакет → «Создать ключ» для сервисного аккаунта. Endpoint: ",e.jsx("code",{className:"bg-vg-surface px-1 rounded",children:"storage.yandexcloud.net"}),", bucket — имя бакета."]})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-vg-accent shrink-0",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Amazon S3"})," — в AWS IAM создайте пользователя с доступом к S3, получите Access Key и Secret Key. Endpoint: ",e.jsx("code",{className:"bg-vg-surface px-1 rounded",children:"s3.amazonaws.com"})," (или региональный, например ",e.jsx("code",{className:"bg-vg-surface px-1 rounded",children:"s3.eu-central-1.amazonaws.com"}),"), bucket — имя созданного бакета."]})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-vg-accent shrink-0",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"MinIO / другой S3-совместимый сервис"})," — укажите адрес сервера (например ",e.jsx("code",{className:"bg-vg-surface px-1 rounded",children:"minio.example.com:9000"}),"), имя bucket и ключи из панели управления."]})]})]}),e.jsxs("p",{className:"text-sm text-vg-muted mt-4 pt-3 border-t border-white/5",children:["Endpoint должен быть валидным хостом (с точкой в домене или с портом), например ",e.jsx("code",{className:"bg-vg-surface px-1 rounded",children:"storage.yandexcloud.net"})," или ",e.jsx("code",{className:"bg-vg-surface px-1 rounded",children:"localhost:9000"}),". Короткие значения вроде «rs» не подходят."]})]})})]})}export{te as default};
