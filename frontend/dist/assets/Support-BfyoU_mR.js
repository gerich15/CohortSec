import{Y as S,r as l,j as e,K as u,aA as y,aB as F,aC as R,a5 as A}from"./index-By3V3s7V.js";import{P as T}from"./paperclip-B_C-K2TJ.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=S("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=S("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),w=5,L=25*1024*1024,O="image/*",P="video/*",V=".pdf,.doc,.docx,.txt";function X(){const[i,h]=l.useState([]),[c,f]=l.useState(""),[C,g]=l.useState(!1),[o,I]=l.useState(null),[r,d]=l.useState([]),[b,x]=l.useState(!1),v=l.useRef(null),k=l.useRef(null),z=l.useRef(null),E=l.useRef(null),_=()=>{var t;return(t=v.current)==null?void 0:t.scrollIntoView({behavior:"smooth"})};l.useEffect(()=>{_()},[i]);const p=t=>{const n=Array.from(t.target.files||[]).filter(s=>s.size<=L);d(s=>[...s,...n].slice(0,w)),t.target.value="",x(!1)},D=t=>d(a=>a.filter((n,s)=>s!==t)),j=async()=>{const t=c.trim();if(!(!t&&r.length===0)){g(!0);try{const a=new FormData;a.append("text",t||" "),o&&a.append("ticket_id",o),r.forEach(s=>a.append("files",s));const{data:n}=await R.post("/support/message",a,{headers:{"Content-Type":void 0},transformRequest:[(s,m)=>(s instanceof FormData&&delete m["Content-Type"],s)]});h(s=>[...s,{id:n.id||String(Date.now()),text:t||"(вложение)",role:"user",created_at:new Date().toISOString(),attachments:n.attachments||r.map(m=>({name:m.name}))}]),f(""),d([]),!o&&n.ticket_id&&I(n.ticket_id),setTimeout(()=>{h(s=>[...s,{id:`support-${Date.now()}`,text:"Спасибо за обращение. Ваше сообщение получено. Ожидайте ответа в течение 24 часов.",role:"support",created_at:new Date().toISOString()}])},1e3)}catch{A.error("Ошибка отправки. Попробуйте позже.")}finally{g(!1)}}};return e.jsxs("div",{className:"min-h-[70vh] flex flex-col",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold gradient-text mb-2",children:"Поддержка"}),e.jsx("p",{className:"text-vg-muted mb-8",children:"Чат с поддержкой. Вы можете прикладывать изображения, видео и документы."}),e.jsxs("div",{className:"flex-1 rounded-xl border border-white/10 bg-vg-surface/30 flex flex-col min-h-[400px]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[i.length===0&&e.jsxs("div",{className:"text-center py-12 text-vg-muted",children:[e.jsx("p",{children:"Напишите ваше обращение — мы ответим в течение 24 часов."}),e.jsxs("p",{className:"text-sm mt-2",children:["Поддерживаются изображения, видео и документы (до ",w," файлов, макс. 25 МБ)"]})]}),i.map(t=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl px-4 py-3 ${t.role==="user"?"bg-vg-accent/20 border border-vg-accent/40":"bg-white/5 border border-white/10"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.text}),t.attachments&&t.attachments.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:t.attachments.map((a,n)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 text-xs text-vg-muted",children:[e.jsx(u,{size:12}),a.name]},n))}),e.jsxs("p",{className:"text-xs text-vg-muted mt-2",children:[t.role==="support"?"Поддержка":"Вы"," · ",new Date(t.created_at).toLocaleString("ru")]})]})},t.id)),e.jsx("div",{ref:v})]}),e.jsxs("div",{className:"border-t border-white/10 p-4",children:[r.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:r.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 text-sm",children:[t.type.startsWith("image/")?e.jsx(y,{size:16,className:"text-vg-accent"}):t.type.startsWith("video/")?e.jsx(N,{size:16,className:"text-vg-accent"}):e.jsx(u,{size:16,className:"text-vg-accent"}),e.jsx("span",{className:"truncate max-w-[120px]",children:t.name}),e.jsx("button",{type:"button",onClick:()=>D(a),className:"text-red-400 hover:text-red-300","aria-label":"Удалить",children:e.jsx(F,{size:14})})]},a))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>x(!b),className:"p-2 rounded-lg border border-white/10 hover:bg-white/5 text-vg-muted","aria-label":"Прикрепить файл",children:e.jsx(T,{size:20})}),b&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>x(!1)}),e.jsxs("div",{className:"absolute bottom-full left-0 mb-2 z-20 flex flex-col gap-1 rounded-lg border border-white/10 bg-vg-surface p-2 shadow-xl",children:[e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-white/5 cursor-pointer text-sm",children:[e.jsx(y,{size:18}),"Изображения",e.jsx("input",{ref:z,type:"file",accept:O,multiple:!0,onChange:p,className:"hidden"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-white/5 cursor-pointer text-sm",children:[e.jsx(N,{size:18}),"Видео",e.jsx("input",{ref:E,type:"file",accept:P,multiple:!0,onChange:p,className:"hidden"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-white/5 cursor-pointer text-sm",children:[e.jsx(u,{size:18}),"Документы",e.jsx("input",{ref:k,type:"file",accept:V,multiple:!0,onChange:p,className:"hidden"})]})]})]})]}),e.jsx("input",{type:"text",placeholder:"Введите сообщение...",value:c,onChange:t=>f(t.target.value),onKeyDown:t=>t.key==="Enter"&&!t.shiftKey&&j(),className:"flex-1 px-4 py-3 bg-vg-bg border border-white/10 rounded-lg text-white placeholder-vg-muted"}),e.jsx("button",{type:"button",onClick:j,disabled:C||!c.trim()&&r.length===0,className:"p-3 rounded-lg bg-vg-accent text-black hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Отправить",children:e.jsx(M,{size:20})})]})]})]})]})}export{X as default};
